From 3e35c22ea2e00f565a25b30110de586a58d71f80 Mon Sep 17 00:00:00 2001
From: OpenEmbedded <oe.patch@oe>
Date: Wed, 23 Jul 2025 14:29:01 +0000
Subject: [PATCH] From: OpenEmbedded <oe.patch@oe>

Upstream-Status: Inappropriate [oe-specific]
---
 CMake/Dependencies/libawscpp-CMakeLists.txt       | 3 +--
 CMake/Dependencies/libbenchmark-CMakeLists.txt    | 3 +--
 CMake/Dependencies/libgtest-CMakeLists.txt        | 5 +----
 CMake/Dependencies/libjsmn-CMakeLists.txt         | 3 +--
 CMake/Dependencies/libkvsCommonLws-CMakeLists.txt | 5 +----
 CMake/Dependencies/libmbedtls-CMakeLists.txt      | 5 +----
 CMake/Dependencies/libsrtp-CMakeLists.txt         | 4 +---
 CMake/Dependencies/libusrsctp-CMakeLists.txt      | 4 +---
 CMake/Dependencies/libwebsockets-CMakeLists.txt   | 5 +----
 9 files changed, 9 insertions(+), 28 deletions(-)

Index: amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libawscpp-CMakeLists.txt
===================================================================
--- amazon-kvs-webrtc-sdk-1.12.1.orig/CMake/Dependencies/libawscpp-CMakeLists.txt
+++ amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libawscpp-CMakeLists.txt
@@ -3,8 +3,7 @@ project(libawscpp-download NONE)
 include(ExternalProject)
 
 ExternalProject_Add(libawscpp-download
-    GIT_REPOSITORY    https://github.com/aws/aws-sdk-cpp.git
-    GIT_TAG           1.11.217
+    SOURCE_DIR        "${CMAKE_SOURCE_DIR}/../../../open-source/aws-sdk-cpp"
     LIST_SEPARATOR    "|"
     CMAKE_ARGS       -DBUILD_SHARED_LIBS=OFF
                      -DBUILD_ONLY=kinesisvideo|kinesis-video-webrtc-storage
Index: amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libbenchmark-CMakeLists.txt
===================================================================
--- amazon-kvs-webrtc-sdk-1.12.1.orig/CMake/Dependencies/libbenchmark-CMakeLists.txt
+++ amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libbenchmark-CMakeLists.txt
@@ -6,8 +6,7 @@ include(ExternalProject)
 
 ExternalProject_Add(
   project_libbenchmark
-  GIT_REPOSITORY  https://github.com/google/benchmark
-  GIT_TAG         v1.5.1
+  SOURCE_DIR        "${CMAKE_SOURCE_DIR}/../../../open-source/benchmark"
   PREFIX          ${CMAKE_CURRENT_BINARY_DIR}/build
   CMAKE_ARGS
     -DCMAKE_INSTALL_PREFIX=${OPEN_SRC_INSTALL_PREFIX}
Index: amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libgtest-CMakeLists.txt
===================================================================
--- amazon-kvs-webrtc-sdk-1.12.1.orig/CMake/Dependencies/libgtest-CMakeLists.txt
+++ amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libgtest-CMakeLists.txt
@@ -5,10 +5,7 @@ project(libgtest-download NONE)
 include(ExternalProject)
 
 ExternalProject_Add(libgtest-download
-    GIT_REPOSITORY    https://github.com/google/googletest.git
-    GIT_TAG           release-1.12.1
-    GIT_PROGRESS      TRUE
-    GIT_SHALLOW       TRUE
+    SOURCE_DIR        "${CMAKE_SOURCE_DIR}/../../../open-source/googletest"
     PREFIX            ${CMAKE_CURRENT_BINARY_DIR}/build
     CMAKE_ARGS
         -DCMAKE_INSTALL_PREFIX=${OPEN_SRC_INSTALL_PREFIX}
Index: amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libjsmn-CMakeLists.txt
===================================================================
--- amazon-kvs-webrtc-sdk-1.12.1.orig/CMake/Dependencies/libjsmn-CMakeLists.txt
+++ amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libjsmn-CMakeLists.txt
@@ -4,8 +4,7 @@ project(libjsmn-download NONE)
 
 include(ExternalProject)
 ExternalProject_Add(project_libjsmn
-    GIT_REPOSITORY    https://github.com/zserge/jsmn.git
-    GIT_TAG           v1.0.0
+    SOURCE_DIR        "${CMAKE_SOURCE_DIR}/../../../open-source/jsmn"
     PREFIX            ${CMAKE_CURRENT_BINARY_DIR}/build
     PATCH_COMMAND     git apply --ignore-whitespace ${CMAKE_CURRENT_LIST_DIR}/libjsmn-add-cmakelists.patch
     CMAKE_ARGS        -DCMAKE_INSTALL_PREFIX=${OPEN_SRC_INSTALL_PREFIX}
Index: amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libkvsCommonLws-CMakeLists.txt
===================================================================
--- amazon-kvs-webrtc-sdk-1.12.1.orig/CMake/Dependencies/libkvsCommonLws-CMakeLists.txt
+++ amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libkvsCommonLws-CMakeLists.txt
@@ -5,10 +5,7 @@ project(libkvsCommonLws-download NONE)
 include(ExternalProject)
 
 ExternalProject_Add(libkvsCommonLws-download
-    GIT_REPOSITORY    https://github.com/awslabs/amazon-kinesis-video-streams-producer-c.git
-    GIT_TAG           v1.5.4
-    GIT_PROGRESS      TRUE
-    GIT_SHALLOW       TRUE
+    SOURCE_DIR        "${CMAKE_SOURCE_DIR}/../../../open-source/amazon-kinesis-video-streams-producer-c"
     PREFIX            ${CMAKE_CURRENT_BINARY_DIR}/build
     LIST_SEPARATOR    |
     CMAKE_ARGS        
Index: amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libmbedtls-CMakeLists.txt
===================================================================
--- amazon-kvs-webrtc-sdk-1.12.1.orig/CMake/Dependencies/libmbedtls-CMakeLists.txt
+++ amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libmbedtls-CMakeLists.txt
@@ -20,10 +20,7 @@ message(STATUS "C flags here are ${CMAKE
 
 ExternalProject_Add(
   project_libmbedtls
-  GIT_REPOSITORY  https://github.com/ARMmbed/mbedtls.git
-  GIT_TAG         v2.28.8
-  GIT_PROGRESS    TRUE
-  GIT_SHALLOW     TRUE
+  SOURCE_DIR        "${CMAKE_SOURCE_DIR}/../../../open-source/mbedtls"
   PREFIX          ${CMAKE_CURRENT_BINARY_DIR}/build
   CMAKE_ARGS
     -DCMAKE_INSTALL_PREFIX=${OPEN_SRC_INSTALL_PREFIX}
Index: amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libsrtp-CMakeLists.txt
===================================================================
--- amazon-kvs-webrtc-sdk-1.12.1.orig/CMake/Dependencies/libsrtp-CMakeLists.txt
+++ amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libsrtp-CMakeLists.txt
@@ -56,10 +56,8 @@ message(STATUS "CONFIGURE_COMMAND is ${C
 
 include(ExternalProject)
 ExternalProject_Add(project_libsrtp
-    GIT_REPOSITORY    https://github.com/cisco/libsrtp.git
-    GIT_TAG           bd0f27ec0e299ad101a396dde3f7c90d48efc8fc
+    SOURCE_DIR        ${CMAKE_SOURCE_DIR}/../../../open-source/libsrtp
     PREFIX            ${CMAKE_CURRENT_BINARY_DIR}/build
-    GIT_PROGRESS      TRUE
     CMAKE_ARGS        -DCMAKE_BUILD_TYPE:STRING=${CMAKE_BUILD_TYPE}
                       -DCMAKE_INSTALL_PREFIX:STRING=${OPEN_SRC_INSTALL_PREFIX}
                       -DENABLE_OPENSSL=${LIBSRTP_ENABLE_OPENSSL}
Index: amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libusrsctp-CMakeLists.txt
===================================================================
--- amazon-kvs-webrtc-sdk-1.12.1.orig/CMake/Dependencies/libusrsctp-CMakeLists.txt
+++ amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libusrsctp-CMakeLists.txt
@@ -5,9 +5,7 @@ project(libusrsctp-download NONE)
 include(ExternalProject)
 
 ExternalProject_Add(project_libusrsctp
-    GIT_REPOSITORY    https://github.com/sctplab/usrsctp.git
-    GIT_TAG           1ade45cbadfd19298d2c47dc538962d4425ad2dd
-    GIT_PROGRESS      TRUE
+    SOURCE_DIR        "${CMAKE_SOURCE_DIR}/../../../open-source/usrsctp"
     PREFIX            ${CMAKE_CURRENT_BINARY_DIR}/build
     CMAKE_ARGS        -DCMAKE_INSTALL_PREFIX=${OPEN_SRC_INSTALL_PREFIX}
                       -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
Index: amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libwebsockets-CMakeLists.txt
===================================================================
--- amazon-kvs-webrtc-sdk-1.12.1.orig/CMake/Dependencies/libwebsockets-CMakeLists.txt
+++ amazon-kvs-webrtc-sdk-1.12.1/CMake/Dependencies/libwebsockets-CMakeLists.txt
@@ -29,10 +29,7 @@ if (WIN32)
 endif()
 
 ExternalProject_Add(project_libwebsockets
-    GIT_REPOSITORY    https://github.com/warmcat/libwebsockets.git
-    GIT_TAG           v4.3.3
-    GIT_PROGRESS      TRUE
-    GIT_SHALLOW       TRUE
+    SOURCE_DIR        "${CMAKE_SOURCE_DIR}/../../../open-source/libwebsockets"
     PATCH_COMMAND     ${PATCH_COMMAND}
     PREFIX            ${CMAKE_CURRENT_BINARY_DIR}/build
     LIST_SEPARATOR    |
@@ -66,6 +63,7 @@ ExternalProject_Add(project_libwebsocket
         -DLWS_EXT_PTHREAD_LIBRARIES=${LWS_EXT_PTHREAD_LIBRARIES}
         -DLWS_OPENSSL_INCLUDE_DIRS=${LWS_OPENSSL_INCLUDE_DIRS}
         -DLWS_OPENSSL_LIBRARIES=${LWS_OPENSSL_LIBRARIES}
+	-DCMAKE_POLICY_VERSION_MINIMUM=3.5
     BUILD_ALWAYS      TRUE
     TEST_COMMAND      ""
 )
Index: amazon-kvs-webrtc-sdk-1.12.1/CMakeLists.txt
===================================================================
--- amazon-kvs-webrtc-sdk-1.12.1.orig/CMakeLists.txt
+++ amazon-kvs-webrtc-sdk-1.12.1/CMakeLists.txt
@@ -173,12 +173,6 @@ if(BUILD_DEPENDENCIES)
   endif()
 
   if (USE_OPENSSL)
-    set(BUILD_ARGS -DBUILD_STATIC_LIBS=${BUILD_STATIC_LIBS}
-                   -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
-                   -DBUILD_OPENSSL_PLATFORM=${BUILD_OPENSSL_PLATFORM}
-                   -DOPENSSL_EXTRA=${OPENSSL_EXTRA})
-    build_dependency(openssl ${BUILD_ARGS})
-    set(OPENSSL_ROOT_DIR ${OPEN_SRC_INSTALL_PREFIX})
   elseif(USE_MBEDTLS)
     set(BUILD_ARGS -DBUILD_STATIC_LIBS=${BUILD_STATIC_LIBS}
                    -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
